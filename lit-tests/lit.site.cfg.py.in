@LIT_SITE_CFG_IN_HEADER@
config.llvm_tools_dir = "@LLVM_TOOLS_DIR@"
config.python_executable = "@Python3_EXECUTABLE@"
config.vanguard_build_root = "@CMAKE_BINARY_DIR@"
config.vanguard_bin_dir = os.path.join(config.vanguard_build_root, "lib")
config.vanguard_src_root = "@CMAKE_SOURCE_DIR@"

# This is the lit test configuration for end-to-end tests.

from pathlib import Path
import subprocess
import shutil
import tempfile

# test_source_root: The root path where tests are located.
config.test_source_root = Path(config.vanguard_src_root) / "lit-tests"

# config.llvm_tools_dir = subprocess.check_output(['llvm-config', '--bindir'],
#                                                      text=True).rstrip()

config.extra_suffixes = []

import lit.llvm
lit.llvm.initialize(lit_config, config)

def _run_lit():
    # Let the main config do the real work.
    lit_config.load_config(config, config.test_source_root / "lit.cfg.py")

# test_exec_root: The root path where tests should be run.
override_test_exec_root = os.environ.get('V_TEST_RUN', None)
if override_test_exec_root is None:
    with tempfile.TemporaryDirectory(prefix='vanguard_e2e_test') as test_exec_root:
        config.test_exec_root = test_exec_root
        _run_lit()
else:
    assert Path(override_test_exec_root).is_dir()
    config.test_exec_root = override_test_exec_root
    _run_lit()
